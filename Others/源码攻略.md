## 1. 学习源码的意义

看源码只是一种方法、手段，而不是目的。我也曾经给自己制定过“阅读xxx源码”的目标，现在看起来真的很蠢，一点不smart（specific、measurable、attainable、relevant、time-bound）。只有搞清楚了阅读代码的目标，才能有的放矢，抓住重点，高效达成任务。

看源码的意义总结起来包含但不限于以下几点：

**第一：解决问题(BUG)**

只要是代码，就会有bug，只是说bug的多与少、深与浅罢了。现在大家都喜欢发布、使用开源项目，不同的开源项目社区成熟度、代码质量又会有较大的差异，遇到bug就不足为奇了。

当然，遇到bug肯定是先在网上搜索是否有类似的问题，一般可以在google、Stack Overflow、项目的issues里面有对应的关键词搜索。如果搜不到，那么就只能看源码解决了

**第二：知其所以然**

那么就必须了解这项项目的优缺点，并深知原理，对部分细节（尤其是项目的优势、feature）进行深入研究。如果是成熟的开源项目，遇到问题也许能google到很多答案；但如果是一个处于快速发展中的开源项目，多了解其架构、核心原理，也能帮助快速定位问题。

另外，有的项目文档可能不那么丰富，但又不得不使用，那么如何以正确的姿势使用呢？也得参考源码

**第三：学习**

看源码也是一种不错的学习方式（虽然不一定不是最佳的方式），尤其对于比较优秀的开源项目，能让人大开眼界。

即使是出于学习的目的，也是有很多侧重的，比如

- 学习语言：代码风格、规范、惯用法、高级语法。对于某个语言的新手，找一个熟悉领域的开源项目来深入掌握这门语言，也是一个不错的注意。
- 学习设计：数据接口、框架、整体架构
- 学习理论：算法、协议。比如我之前写过的[raft协议](https://www.cnblogs.com/xybaby/p/10124083.html)，光看论文是很枯燥的，而且算法理论到工程实践还是有一定的差距，这个时候结合开源项目([mongodb](https://www.cnblogs.com/xybaby/p/10165564.html))实现往往更事半功倍。
- 其他

**第四：改造**

一般来说，我们刚开始仅仅是使用一个开源项目，但随着使用的深入，会发现一些自己需要的功能并没有很好的支持，向项目组提的issues也可能得不到快速的响应，这个时候就要自己开分支，改代码，加功能了。当然，比较好的是将自己分支比较好的新feature 给原项目提merge request，反哺开源项目，比如阿里的[Blink](https://zhuanlan.zhihu.com/p/55868725)

**第五：借鉴**

他山之石可以攻玉，如果有需要重新开始自己造轮子，那么参考一些已有的、优秀的轮子肯定是有好处的。

**副产品：找工作**

这一点，不应该作为我们阅读源码的出发点，但是确实能在实际中对找工作、面试有加成，算是副产品吧。



## 2. 源码学习步骤

1. 查找官方文档、相关的总结文章
2. 运行程序，观察表现
3. 运行源码，断点调试
4. 画图梳理类关系
5. 记录问题，解决问题
6. 先写笔记，再总结为文章
7. 解决issue
8. 步骤 2-6 重复进行



**学习步骤（详细版）:**

### 1. 查找官方文档、总结文章

决定要学习的模块，查找官方文档、相关的总结文章，整理出大概的学习内容与目标

比如说我想研究网络模块，首先去官方文档、论坛、wiki里面过一遍网络相关的所有内容，这时候遇到不懂的问题尽可能解决，解决不了的就把问题记下来，先去官方文档看我觉得是非常有必要的，因为这里的文章是最权威的，错误率非常低。然后，去Google、百度搜索相关的文章与帖子，同时可以加入一些技术qq群（有一些水群果断退了就行，保留一些优质的交流群），过一遍这些文章和资料。目前能看到比较好的技术网站大体上就是各个技术对应的官方网站（论坛）、StackOverflow、知乎、博客园、简书、CSDN、一些个人网站等，当然有些网站复制粘贴现象严重，需要自己筛选。建议能找到原文链接的尽量去原文里面看，因为你有可能从原创作者那里看到更多优秀的文章。

### **2.** 运行程序，观察表现

在运行程序的时候，我们需要调整各种参数来执行不同的情况，进而观察其表现效果来验证我们的猜想与结论

比如说，对于一个处于休眠状态的Actor属性是否能正常同步，如果客户端属性与服务器一样是否还会执行回调函数等。执行程序可以快速的得到结论，然后根据结论我们可以更快速准确的进行分析。为了提高效率，最好在一开始就设置不同的配置、GM等来在项目运行时动态改变运行内容，因为大型项目一般都是编译型语言，我们可能可能需要频繁的修改代码编译再重新运行。

### **3. **运行源码，断点调试

调试可以说是最为关键的一步了，80%的细节需要你在调试中去理解

函数什么时候执行到这里（函数断点）？每一步每一个属性值是多少？属性值什么时候发生变化（条件断点，内存断点）？一个完整的执行流程是什么样的（函数堆栈）？这些问题需要你一点一点的进行跟踪调试，最后再去解决。

### **4.** 画图梳理类关系

画类图、流程图，先把遇到的重要类记录下来，表明各个类的关系，画图的习惯可能很多人没有，但是我个人觉得这是一个必不可少的环节，因为他可以大幅度提高你对框架理解的速度

对于任何一个复杂的项目，每一个模块都会牵扯到大量的类（排除纯C项目），类的关系错综复杂，而且为了降低耦合还可能用到各种设计模式，这些都大大提高了代码的阅读难度，很有可能你看了3、4个类之后就完全搞混了他们都是干什么的。举例来说，我在看UE4属性同步模块的时候，完全被各个类之间的关系搞蒙了，所以我看到一个类就把他的类图画下来，看到相关的类就记录他们的关系，最后得到了下面这样一个简化的类图。经过梳理后，几句话我就可以概括他们之间的关系。

当然，除了类图以外，还有流程图、时序图，甚至是你自己为了方便发明的“模块关系图”，这时候图的种类与规范其实没有那么重要，只要能帮助你理解就行。

![img](https://pic2.zhimg.com/80/v2-4af773773bcf4086f2805f41f122a6ed_720w.jpg)

> 更新一下：我后来意识到VS其实是自带显示类图功能的，可以直接使用这个功能。点击菜单栏——视图——类视图，然后右键你要查看的项目——查看类视图。效果如下图，很明显问题比较多，一是格式太死板不方便阅读，二是不能很好的表示各个类间更进一步的关系（StarUML对于模板类支持的也不好），三是不方便修改。如果是一个小的模块倒是可以用它查看，比较方便。

![img](https://pic1.zhimg.com/80/v2-9f9860eed8bbe23e66a15a158759fb68_720w.jpg)



### **5.** 记录问题，解决问题

记录的问题有两种：别人给你的问题以及你自己给自己的问题

别人给你的问题：你在阅读的时候不可能一帆风顺，可能在第一步的时候，就已经遇到了无数的问题。这时候不要着急，按照重要程度顺序依次解决，简单的问题直接网上搜一搜，解决不了可以找身边的大神，网上的牛人解决。如果还是不行，就把问题记下来，然后继续学习，当你深入到一定程度的时候，你的问题可能就不攻自破了。

自己给自己的问题：当你解决了别人给你的问题后，你应该已经理解了一大半了。不过，任何人写的文章都不可能覆盖到全部，你需要自己挖掘更多更深的问题，然后自己再去解答，这样你才能做到比别人了解的更多，更能体现出你自己的价值。

### 6. 先写笔记，再总结为文章

写文章这件事相比上面的步骤我觉得不算是必须的，这个适合那些追求完美还能挤出时间的人。你写的东西是要给别人看的，所以你的目的是给别人讲清楚。我在写文章的时候会去考虑这个东西我说的真的对么，有没有把握，考虑的是否全面。在这种自我拷问下，我会尽可能的完善我的知识体系，修改文章中那些看起来不够准确的内容。如果最后能做到给读者讲清楚的话，那你是真的会了。

写笔记相比写文章要轻松很多，我只是把我总结的内容，学习的收获记录下来，不需要考虑太多的东西。虽然没有写文章那么追求完美，但是这个过程中我们可能也会多了很多思考，在之后的学习过程中快速的回忆起自己学习的经验。

> 备注：第一次执行这个过程是相当漫长和艰难的，如果和我一样一开始知识储备不够，那么几乎每走一步都需要大量的学习和查资料。不过只要坚持下去，你最后会发现自己的收获非常大，阅读其他模块的源码也变得容易很多。

### **7. 解决issue**

如果自己没有问题，那么就帮忙解决别人的问题，通常来说，开源项目都有许多待解决的issue，从中选择一个入手。

## 3. 结语

最后，如果只是为了使用好一个工具，不需要彻彻底底的理解所有内容，因为时间是有限的。如果真的是抱着学习的态度去研究源码细节，那请做好花费大量时间的准备并坚持下去。



## 
